<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚˜ë§Œì˜ ì˜ì–´ë‹¨ì–´ í€´ì¦ˆ</title>
  <meta name="theme-color" content="#ffffff">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f7f7f7;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button, select {
      font-size: 18px;
      padding: 10px;
      width: 100%;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #aaa;
      box-sizing: border-box;
    }
    button {
      background: #4a8fff;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #3a7fee;
    }
    .question {
      font-size: 22px;
      margin: 20px 0;
      font-weight: bold;
    }
    .result {
      margin-top: 20px;
      font-size: 18px;
      white-space: pre-line;
    }
    .mode-selector {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    .mode-btn {
      flex: 1;
      padding: 15px;
      background: #e0e0e0;
      color: #333;
      border: 2px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
    }
    .mode-btn:hover {
      background: #d0d0d0;
    }
    .mode-btn.active {
      background: #4a8fff;
      color: white;
      border-color: #4a8fff;
    }
    .test-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .test-table th {
      background: #4a8fff;
      color: white;
      padding: 10px;
      text-align: left;
      font-size: 16px;
    }
    .test-table td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    .test-table input {
      width: 100%;
      padding: 5px;
      margin: 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .test-table input.correct {
      background: #d4edda;
      border-color: #28a745;
    }
    .test-table input.wrong {
      background: #f8d7da;
      border-color: #dc3545;
    }
    .score-display {
      font-size: 24px;
      font-weight: bold;
      color: #4a8fff;
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: #f0f8ff;
      border-radius: 8px;
    }
    .answer-key {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    .progress {
      margin: 10px 0;
      font-size: 16px;
      color: #666;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>ğŸ“˜ ë‚˜ë§Œì˜ ì˜ì–´ë‹¨ì–´ í€´ì¦ˆ</h2>

  <!-- ëª¨ë“œ ì„ íƒ ë²„íŠ¼ -->
  <div class="mode-selector">
    <button class="mode-btn active" onclick="selectMode('quiz')" id="quizModeBtn">
      ğŸ¯ í€´ì¦ˆ ëª¨ë“œ
    </button>
    <button class="mode-btn" onclick="selectMode('test')" id="testModeBtn">
      ğŸ“ ì‹œí—˜ì§€ ëª¨ë“œ
    </button>
  </div>

  <!-- í€´ì¦ˆ ëª¨ë“œ ì„¤ì • -->
  <div id="quizSettings">
    <label>ë¬¸ì œ ìœ í˜• ì„ íƒ:</label>
    <select id="quizMode">
      <option value="mixed">í˜¼í•© (ì˜ì–´+í•œê¸€)</option>
      <option value="korean">í•œê¸€ ëœ»ë§Œ ë§ì¶”ê¸° (ì˜ì–´â†’í•œê¸€)</option>
      <option value="english">ì˜ì–´ ë‹¨ì–´ë§Œ ë§ì¶”ê¸° (í•œê¸€â†’ì˜ì–´)</option>
    </select>

    <label>ë¬¸ì œ ê°œìˆ˜ ì„ íƒ (ìµœëŒ€ 50):</label>
    <select id="quizCount">
      <option value="10">10ê°œ</option>
      <option value="20">20ê°œ</option>
      <option value="30">30ê°œ</option>
      <option value="40">40ê°œ</option>
      <option value="50">50ê°œ</option>
    </select>

    <button onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
  </div>

  <!-- ì‹œí—˜ì§€ ëª¨ë“œ ì„¤ì • -->
  <div id="testSettings" style="display:none;">
    <label>ì‹œí—˜ì§€ ìœ í˜• ì„ íƒ:</label>
    <select id="testMode">
      <option value="mixed">í˜¼í•© (ì˜ì–´+í•œê¸€)</option>
      <option value="korean">í•œê¸€ ëœ»ë§Œ ë§ì¶”ê¸° (ì˜ì–´â†’í•œê¸€)</option>
      <option value="english">ì˜ì–´ ë‹¨ì–´ë§Œ ë§ì¶”ê¸° (í•œê¸€â†’ì˜ì–´)</option>
    </select>

    <label>ë¬¸ì œ ê°œìˆ˜ ì„ íƒ:</label>
    <select id="testCount">
      <option value="20">20ê°œ</option>
      <option value="30">30ê°œ</option>
      <option value="40">40ê°œ</option>
      <option value="50">50ê°œ</option>
    </select>

    <button onclick="startTest()">ì‹œí—˜ì§€ ìƒì„±</button>
  </div>

  <!-- í€´ì¦ˆ ì˜ì—­ -->
  <div id="quizArea" style="display:none;">
    <div class="progress" id="progress"></div>
    <div class="question" id="question"></div>
    <button onclick="speakWord()" id="speakBtn" style="background: #28a745; margin-bottom: 10px;">
      ğŸ”Š ë°œìŒ ë“£ê¸°
    </button>
    <input id="answerInput" placeholder="ì •ë‹µ ì…ë ¥..." onkeypress="handleKeyPress(event)" />
    <button onclick="checkAnswer()">ì œì¶œ</button>
    <div class="result" id="result"></div>
    <button onclick="nextQuestion()" id="nextBtn" style="display:none;">ë‹¤ìŒ ë¬¸ì œ</button>
  </div>

  <!-- ì‹œí—˜ì§€ ì˜ì—­ -->
  <div id="testArea" style="display:none;">
    <h3>ğŸ“ ì˜ì–´ ë‹¨ì–´ ì‹œí—˜ì§€</h3>
    <div id="testTableContainer"></div>
    <button onclick="submitTest()" id="submitTestBtn" style="margin-top: 20px;">ì±„ì í•˜ê¸°</button>
    <div id="scoreArea" style="display:none;">
      <div class="score-display" id="scoreDisplay"></div>
      <button onclick="resetTest()">ë‹¤ì‹œ í’€ê¸°</button>
      <button onclick="selectMode('test')">ìƒˆ ì‹œí—˜ì§€</button>
    </div>
  </div>
</div>

<script>
// -----------------------------
// ì˜ë‹¨ì–´ ëª©ë¡ (words.jsonì—ì„œ ë¶ˆëŸ¬ì˜´)
// -----------------------------
let WORDS = [];
let isLoading = true;

// JSON íŒŒì¼ì—ì„œ ë‹¨ì–´ ë¶ˆëŸ¬ì˜¤ê¸°
fetch('words.json')
  .then(response => {
    if (!response.ok) {
      throw new Error('words.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
    return response.json();
  })
  .then(data => {
    WORDS = data;
    isLoading = false;
    console.log(`${WORDS.length}ê°œì˜ ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
  })
  .catch(error => {
    isLoading = false;
    alert('ë‹¨ì–´ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
    console.error('Error loading words:', error);
  });

let quizList = [];
let currentQuiz = null;
let currentIndex = 0;
let totalCount = 0;
let testList = [];
let currentMode = 'quiz';

// -----------------------------
// ëª¨ë“œ ì„ íƒ
// -----------------------------
function selectMode(mode) {
  currentMode = mode;
  
  // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
  document.getElementById('quizModeBtn').classList.remove('active');
  document.getElementById('testModeBtn').classList.remove('active');
  
  if (mode === 'quiz') {
    document.getElementById('quizModeBtn').classList.add('active');
    document.getElementById('quizSettings').style.display = 'block';
    document.getElementById('testSettings').style.display = 'none';
    document.getElementById('quizArea').style.display = 'none';
    document.getElementById('testArea').style.display = 'none';
  } else {
    document.getElementById('testModeBtn').classList.add('active');
    document.getElementById('quizSettings').style.display = 'none';
    document.getElementById('testSettings').style.display = 'block';
    document.getElementById('quizArea').style.display = 'none';
    document.getElementById('testArea').style.display = 'none';
  }
}

// -----------------------------
// í€´ì¦ˆ ì‹œì‘
// -----------------------------
function startQuiz() {
  // ë¡œë”© ì²´í¬
  if (isLoading) {
    alert('ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
    return;
  }

  const count = Number(document.getElementById("quizCount").value);
  const mode = document.getElementById("quizMode").value;
  totalCount = count;

  // ë‹¨ì–´ ìˆ˜ ì²´í¬
  if (WORDS.length < count) {
    alert(`ë‹¨ì–´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ ${WORDS.length}ê°œì˜ ë‹¨ì–´ë§Œ ìˆìŠµë‹ˆë‹¤.`);
    return;
  }

  // ë¦¬ìŠ¤íŠ¸ ì„ê¸°
  quizList = [...WORDS]
    .sort(() => Math.random() - 0.5)
    .slice(0, count)
    .map(item => {
      let isWordMode;
      
      // ë¬¸ì œ ìœ í˜•ì— ë”°ë¼ ì„¤ì •
      if (mode === "korean") {
        // í•œê¸€ ëœ»ë§Œ ë§ì¶”ê¸°: ì˜ì–´ ë‹¨ì–´ ì œì‹œ â†’ í•œê¸€ ë‹µ
        isWordMode = true;
      } else if (mode === "english") {
        // ì˜ì–´ ë‹¨ì–´ë§Œ ë§ì¶”ê¸°: í•œê¸€ ëœ» ì œì‹œ â†’ ì˜ì–´ ë‹µ
        isWordMode = false;
      } else {
        // í˜¼í•©: ëœë¤
        isWordMode = Math.random() < 0.5;
      }
      
      return {
        question: isWordMode ? item.word : item.meaning.join(", "),
        answerList: isWordMode ? item.meaning : [item.word],
        fullMeaning: item.meaning,
        originalWord: item.word,
        isWordMode: isWordMode
      };
    });

  currentIndex = 0;
  document.getElementById("quizArea").style.display = "block";
  document.getElementById("result").innerHTML = "";
  document.getElementById("nextBtn").style.display = "none";
  showQuestion();
}

// -----------------------------
// ë¬¸ì œ ì¶œë ¥
// -----------------------------
function showQuestion() {
  currentQuiz = quizList[currentIndex];
  document.getElementById("progress").textContent = 
    `ì§„í–‰: ${currentIndex + 1} / ${totalCount}`;
  document.getElementById("question").textContent =
    `ë¬¸ì œ ${currentIndex + 1}: ${currentQuiz.question}`;
  document.getElementById("answerInput").value = "";
  document.getElementById("result").innerHTML = "";
  document.getElementById("nextBtn").style.display = "none";
  document.getElementById("answerInput").focus();
}

// -----------------------------
// ë‹µì•ˆ ì²´í¬
// -----------------------------
function checkAnswer() {
  const user = document.getElementById("answerInput").value.trim();
  if (!user) {
    alert("ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  const result = document.getElementById("result");

  // ì •ë‹µ ì¡°ê±´ (ë¶€ë¶„ì¼ì¹˜ í—ˆìš©)
  const isCorrect = currentQuiz.answerList.some(ans =>
    ans.toLowerCase().includes(user.toLowerCase()) || 
    user.toLowerCase().includes(ans.toLowerCase())
  );

  // ë§ì¶˜ ì‹¤ì œ ëœ»ë§Œ
  const matchedMeaning = currentQuiz.answerList.filter(ans =>
    ans.toLowerCase().includes(user.toLowerCase()) || 
    user.toLowerCase().includes(ans.toLowerCase())
  );

  // ì „ì²´ ëœ» ì¤‘ ë‚˜ë¨¸ì§€
  const otherMeanings = currentQuiz.fullMeaning.filter(
    m => !matchedMeaning.includes(m)
  );

  if (isCorrect) {
    result.innerHTML =
      `â­• <b>ì •ë‹µì…ë‹ˆë‹¤!</b><br>
      ì…ë ¥í•œ ë‹µ: ${user}<br>
      ë§ëŠ” ì •ë‹µ: ${matchedMeaning.join(", ")}<br>
      ${otherMeanings.length > 0 ? `ë‹¤ë¥¸ ëœ»ë“¤: ${otherMeanings.join(", ")}` : ''}`;
  } else {
    result.innerHTML =
      `âŒ <b>ì˜¤ë‹µì…ë‹ˆë‹¤.</b><br>
      ì…ë ¥í•œ ë‹µ: ${user}<br>
      ì •ë‹µ: ${currentQuiz.answerList.join(", ")}<br>
      ì „ì²´ ëœ»: ${currentQuiz.fullMeaning.join(", ")}`;
  }

  // ë‹¤ìŒ ë²„íŠ¼ í‘œì‹œ
  document.getElementById("nextBtn").style.display = "block";
}

// -----------------------------
// ë‹¤ìŒ ë¬¸ì œ
// -----------------------------
function nextQuestion() {
  currentIndex++;
  if (currentIndex >= quizList.length) {
    alert("í€´ì¦ˆ ì™„ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!");
    document.getElementById("quizArea").style.display = "none";
    return;
  }
  showQuestion();
}

// -----------------------------
// ìŒì„± ë°œìŒ (ì˜ì–´ ë‹¨ì–´ë§Œ)
// -----------------------------
function speakWord() {
  // í˜„ì¬ ë¬¸ì œê°€ ì˜ì–´ ë‹¨ì–´ì¸ ê²½ìš°ì—ë§Œ ë°œìŒ
  if (!currentQuiz) return;
  
  let textToSpeak = "";
  
  // ì˜ì–´ ë‹¨ì–´ë¥¼ ë¬¼ì–´ë³´ëŠ” ë¬¸ì œì¸ ê²½ìš° (í•œê¸€ ëœ» â†’ ì˜ì–´ ë‹µ)
  if (!currentQuiz.isWordMode) {
    textToSpeak = currentQuiz.originalWord;
  } 
  // í•œê¸€ ëœ»ì„ ë¬¼ì–´ë³´ëŠ” ë¬¸ì œì¸ ê²½ìš° (ì˜ì–´ ë‹¨ì–´ â†’ í•œê¸€ ë‹µ)
  else {
    textToSpeak = currentQuiz.originalWord;
  }
  
  // ìŒì„± í•©ì„±
  const utterance = new SpeechSynthesisUtterance(textToSpeak);
  utterance.lang = 'en-US'; // ì˜ì–´ ë°œìŒ
  utterance.rate = 0.8; // ì†ë„ (0.8 = ì¡°ê¸ˆ ëŠë¦¬ê²Œ)
  
  // ë°œìŒ ì‹¤í–‰
  window.speechSynthesis.cancel(); // ì´ì „ ìŒì„± ì·¨ì†Œ
  window.speechSynthesis.speak(utterance);
}

// -----------------------------
// ì‹œí—˜ì§€ ëª¨ë“œ ì‹œì‘
// -----------------------------
function startTest() {
  // ë¡œë”© ì²´í¬
  if (isLoading) {
    alert('ë‹¨ì–´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
    return;
  }

  const count = Number(document.getElementById("testCount").value);
  const mode = document.getElementById("testMode").value;

  // ë‹¨ì–´ ìˆ˜ ì²´í¬
  if (WORDS.length < count) {
    alert(`ë‹¨ì–´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ ${WORDS.length}ê°œì˜ ë‹¨ì–´ë§Œ ìˆìŠµë‹ˆë‹¤.`);
    return;
  }

  // ì‹œí—˜ì§€ ë¦¬ìŠ¤íŠ¸ ìƒì„±
  testList = [...WORDS]
    .sort(() => Math.random() - 0.5)
    .slice(0, count)
    .map((item, index) => {
      let isWordMode;
      
      if (mode === "korean") {
        isWordMode = true; // ì˜ì–´ â†’ í•œê¸€
      } else if (mode === "english") {
        isWordMode = false; // í•œê¸€ â†’ ì˜ì–´
      } else {
        isWordMode = Math.random() < 0.5; // í˜¼í•©
      }
      
      return {
        id: index,
        question: isWordMode ? item.word : item.meaning.join(", "),
        correctAnswer: isWordMode ? item.meaning : [item.word],
        fullMeaning: item.meaning,
        originalWord: item.word,
        isWordMode: isWordMode,
        userAnswer: ""
      };
    });

  // ì‹œí—˜ì§€ í…Œì´ë¸” ìƒì„±
  createTestTable();
  
  document.getElementById('testArea').style.display = 'block';
  document.getElementById('scoreArea').style.display = 'none';
  document.getElementById('submitTestBtn').style.display = 'block';
}

// -----------------------------
// ì‹œí—˜ì§€ í…Œì´ë¸” ìƒì„±
// -----------------------------
function createTestTable() {
  let html = '<table class="test-table">';
  html += '<thead><tr><th style="width:50px;">ë²ˆí˜¸</th><th>ë¬¸ì œ</th><th>ë‹µì•ˆ</th></tr></thead>';
  html += '<tbody>';
  
  testList.forEach((item, index) => {
    html += `
      <tr>
        <td>${index + 1}</td>
        <td>${item.question}</td>
        <td>
          <input type="text" 
                 id="answer_${item.id}" 
                 placeholder="ë‹µ ì…ë ¥"
                 autocomplete="off" />
        </td>
      </tr>
    `;
  });
  
  html += '</tbody></table>';
  document.getElementById('testTableContainer').innerHTML = html;
}

// -----------------------------
// ì‹œí—˜ì§€ ì±„ì 
// -----------------------------
function submitTest() {
  let correctCount = 0;
  
  testList.forEach(item => {
    const inputEl = document.getElementById(`answer_${item.id}`);
    const userAnswer = inputEl.value.trim();
    item.userAnswer = userAnswer;
    
    // ì •ë‹µ ì²´í¬ (ë¶€ë¶„ ì¼ì¹˜ í—ˆìš©)
    const isCorrect = item.correctAnswer.some(ans =>
      ans.toLowerCase().includes(userAnswer.toLowerCase()) || 
      userAnswer.toLowerCase().includes(ans.toLowerCase())
    );
    
    // ìŠ¤íƒ€ì¼ ì ìš©
    if (userAnswer === "") {
      inputEl.classList.remove('correct', 'wrong');
    } else if (isCorrect) {
      inputEl.classList.add('correct');
      inputEl.classList.remove('wrong');
      correctCount++;
    } else {
      inputEl.classList.add('wrong');
      inputEl.classList.remove('correct');
    }
    
    // ì •ë‹µ í‘œì‹œ
    if (!isCorrect && userAnswer !== "") {
      const correctText = item.correctAnswer.join(", ");
      if (!inputEl.nextElementSibling || !inputEl.nextElementSibling.classList.contains('answer-key')) {
        const answerKey = document.createElement('div');
        answerKey.className = 'answer-key';
        answerKey.textContent = `ì •ë‹µ: ${correctText}`;
        inputEl.parentElement.appendChild(answerKey);
      }
    }
  });
  
  // ì ìˆ˜ í‘œì‹œ
  const score = Math.round((correctCount / testList.length) * 100);
  document.getElementById('scoreDisplay').innerHTML = `
    <div>ì´ ${testList.length}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì •ë‹µ</div>
    <div style="font-size: 36px; margin-top: 10px;">${score}ì </div>
  `;
  
  document.getElementById('scoreArea').style.display = 'block';
  document.getElementById('submitTestBtn').style.display = 'none';
  
  // ìŠ¤í¬ë¡¤ì„ ì ìˆ˜ë¡œ ì´ë™
  document.getElementById('scoreDisplay').scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// -----------------------------
// ì‹œí—˜ì§€ ì´ˆê¸°í™”
// -----------------------------
function resetTest() {
  testList.forEach(item => {
    const inputEl = document.getElementById(`answer_${item.id}`);
    if (inputEl) {
      inputEl.value = "";
      inputEl.classList.remove('correct', 'wrong');
      
      // ì •ë‹µ í‘œì‹œ ì œê±°
      const answerKey = inputEl.parentElement.querySelector('.answer-key');
      if (answerKey) {
        answerKey.remove();
      }
    }
  });
  
  document.getElementById('scoreArea').style.display = 'none';
  document.getElementById('submitTestBtn').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// -----------------------------
// ì—”í„°í‚¤ë¡œ ì œì¶œ
// -----------------------------
function handleKeyPress(event) {
  if (event.key === "Enter") {
    const nextBtn = document.getElementById("nextBtn");
    if (nextBtn.style.display === "none") {
      checkAnswer();
    } else {
      nextQuestion();
    }
  }
}
</script>
</body>
</html>